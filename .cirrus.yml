freebsd_instance:
  image: freebsd-11-2-release-amd64

task:
  environment:
    BINTRAY_USER: ENCRYPTED[0b1be3374ce07058c77081df3828a8e13ec32372f605403114a9ac63977d1d72b48a08d8512c3d05fd02d951d768fd31]
    BINTRAY_KEY: ENCRYPTED[94155bf17182955499eca904fcadb3071086afe16bc3b4f2ffba88dfea6ae8002fa15bc36dc1cb2b0077c4294a1531c5]
  install_script: pkg install -y libuv cmake jansson cutter
  script: cd port-internal/ && make package && cd work/pkg/ && pkg repo . && \
    curl -s -XPOST -d '{"name":"alligator", "licenses": ["Apache-2.0"], "vcs_url": "https://github.com/alligatormon/alligator.git", "desc":"alligator is aggregator for system and software metrics"}' -u$BINTRAY_USER:$BINTRAY_KEY -H "Content-Type:application/json" -H "Accept:application/json" https://api.bintray.com/packages/alligatormon/freebsd/ && \
    curl -sT alligator-${CIRRUS_TAG}.txz -u$BINTRAY_USER:$BINTRAY_KEY -H "X-Bintray-Package:alligator" -H "X-Bintray-Version:${CIRRUS_TAG}" https://api.bintray.com/content/alligatormon/freebsd/ && \
    curl -s -XPOST -u$BINTRAY_USER:$BINTRAY_KEY -H "Content-Type:application/json" -H "Accept:application/json" https://api.bintray.com/content/alligatormon/freebsd/alligator/${CIRRUS_TAG}/publish && \
    curl -s -XPOST -d '{"name":"alligator", "licenses": ["Apache-2.0"], "vcs_url": "https://github.com/alligatormon/alligator.git", "desc":"alligator is aggregator for system and software metrics"}' -u$BINTRAY_USER:$BINTRAY_KEY -H "Content-Type:application/json" -H "Accept:application/json" https://api.bintray.com/packages/alligatormon/freebsd/ && \
    curl -sT digests.txz -u$BINTRAY_USER:$BINTRAY_KEY -H "X-Bintray-Package:alligator" -H "X-Bintray-Version:${CIRRUS_TAG}" https://api.bintray.com/content/alligatormon/freebsd/ && \
    curl -s -XPOST -u$BINTRAY_USER:$BINTRAY_KEY -H "Content-Type:application/json" -H "Accept:application/json" https://api.bintray.com/content/alligatormon/freebsd/alligator/${CIRRUS_TAG}/publish && \
    curl -s -XPOST -d '{"name":"alligator", "licenses": ["Apache-2.0"], "vcs_url": "https://github.com/alligatormon/alligator.git", "desc":"alligator is aggregator for system and software metrics"}' -u$BINTRAY_USER:$BINTRAY_KEY -H "Content-Type:application/json" -H "Accept:application/json" https://api.bintray.com/packages/alligatormon/freebsd/ && \
    curl -sT meta.txz -u$BINTRAY_USER:$BINTRAY_KEY -H "X-Bintray-Package:alligator" -H "X-Bintray-Version:${CIRRUS_TAG}" https://api.bintray.com/content/alligatormon/freebsd/ && \
    curl -s -XPOST -u$BINTRAY_USER:$BINTRAY_KEY -H "Content-Type:application/json" -H "Accept:application/json" https://api.bintray.com/content/alligatormon/freebsd/alligator/${CIRRUS_TAG}/publish && \
    curl -s -XPOST -d '{"name":"alligator", "licenses": ["Apache-2.0"], "vcs_url": "https://github.com/alligatormon/alligator.git", "desc":"alligator is aggregator for system and software metrics"}' -u$BINTRAY_USER:$BINTRAY_KEY -H "Content-Type:application/json" -H "Accept:application/json" https://api.bintray.com/packages/alligatormon/freebsd/ && \
    curl -sT packagesite.txz -u$BINTRAY_USER:$BINTRAY_KEY -H "X-Bintray-Package:alligator" -H "X-Bintray-Version:${CIRRUS_TAG}" https://api.bintray.com/content/alligatormon/freebsd/ && \
    curl -s -XPOST -u$BINTRAY_USER:$BINTRAY_KEY -H "Content-Type:application/json" -H "Accept:application/json" https://api.bintray.com/content/alligatormon/freebsd/alligator/${CIRRUS_TAG}/publish

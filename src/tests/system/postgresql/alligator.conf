entrypoint {
	tcp 1111;
}

modules {
	postgresql /usr/lib64/libpq.so;
}

aggregate {
	postgresql postgresql://postgres@localhost name=pg;
}

query {
	expr "SELECT pg_database.datname dbname, pg_database_size(pg_database.datname) as size FROM pg_database";
	field size;
	datasource pg;
	make postgresql_databases_size;
}
query {
	expr "SELECT count(datname) FROM pg_database";
	field count;
	datasource pg;
	make postgresql_databases_count;
}
query {
	expr "SELECT now() - pg_last_xact_replay_timestamp() AS replication_delay";
	field replication_delay;
	datasource pg;
	make postgresql_replication_lag;
}
query {
	expr "extract (epoch from now() - pg_postmaster_start_time())::int as start_time_seconds";
	field start_time_seconds;
	datasource pg;
	make postgresql_start_time;
}
query {
	expr "SELECT sum(numbackends)*100/(SELECT current_setting('max_connections')::int) AS percent_of_total FROM pg_stat_database"
	field percent_of_total;
	datasource pg;
	make postgresql_connections_percent;
}
query {
	expr "SELECT count(*) FROM pg_stat_replication WHERE state='streaming'";
	field count;
	datasource pg;
	make postgresql_number_replicas;
}
